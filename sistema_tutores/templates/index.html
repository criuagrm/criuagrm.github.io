<!doctype html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema de Tutores — UAGRM</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { 
            sans: ["Outfit", "sans-serif"], 
            display: ["Space Grotesk", "sans-serif"] 
          },
          colors: {
            'uagrm-red': '#cc0000',
            'uagrm-dark': '#0f172a',
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out forwards',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
  </script>
  
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Efecto para ocultar scroll pero permitir deslizar */
    .snap-container {
        -webkit-overflow-scrolling: touch;
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans antialiased overflow-x-hidden">

  <div id="main-view" class="relative min-h-screen flex flex-col justify-between transition-opacity duration-500">
    
    <nav class="absolute top-0 w-full z-40 p-6">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-uagrm-red text-white flex items-center justify-center font-bold text-lg shadow-lg">CP</div>
            <div>
                <h1 class="font-display font-bold text-slate-900 leading-tight">Ciencia Política</h1>
                <p class="text-xs text-slate-500 uppercase tracking-widest">Gestión de Practicum</p>
            </div>
        </div>
    </nav>

    <div class="flex-1 flex flex-col justify-center pt-24 pb-0 lg:pb-0 px-6 max-w-7xl mx-auto w-full z-10">
        <div class="max-w-2xl animate-fade-in">
            <span class="inline-block px-3 py-1 rounded-full bg-red-100 text-red-600 text-xs font-bold uppercase tracking-widest mb-4 border border-red-200">
                Sistema Oficial
            </span>
            <h2 class="font-display text-4xl md:text-6xl font-bold text-slate-900 mb-6 leading-tight">
                Asignación de <br> <span class="text-uagrm-red">Tutores de Tesis</span>
            </h2>
            <p class="text-lg text-slate-600 mb-10 max-w-lg">
                Selecciona tu nivel de Practicum para visualizar la disponibilidad de docentes y generar tu carta de solicitud automáticamente.
            </p>
        </div>

        <div class="w-full mb-10 lg:mb-20">
            <div class="flex gap-6 overflow-x-auto snap-x snap-mandatory scrollbar-hide pb-4 snap-container">
                
                <div onclick="cargarNivel('II')" class="min-w-[85%] md:min-w-[350px] snap-center bg-white rounded-3xl p-6 border border-slate-200 shadow-sm hover:shadow-xl hover:border-red-200 transition cursor-pointer group relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-red-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-red-100"></div>
                    <div class="relative z-10">
                        <div class="w-12 h-12 rounded-2xl bg-slate-100 text-slate-600 flex items-center justify-center text-xl mb-4 group-hover:bg-red-600 group-hover:text-white transition"><i class="fa-solid fa-magnifying-glass"></i></div>
                        <h3 class="font-display text-2xl font-bold text-slate-900 mb-1">Practicum II</h3>
                        <p class="text-slate-500 text-sm font-medium uppercase tracking-wide">Diagnóstico</p>
                    </div>
                </div>

                <div onclick="cargarNivel('III')" class="min-w-[85%] md:min-w-[350px] snap-center bg-white rounded-3xl p-6 border border-slate-200 shadow-sm hover:shadow-xl hover:border-red-200 transition cursor-pointer group relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-blue-100"></div>
                    <div class="relative z-10">
                        <div class="w-12 h-12 rounded-2xl bg-slate-100 text-slate-600 flex items-center justify-center text-xl mb-4 group-hover:bg-blue-600 group-hover:text-white transition"><i class="fa-solid fa-pen-ruler"></i></div>
                        <h3 class="font-display text-2xl font-bold text-slate-900 mb-1">Practicum III</h3>
                        <p class="text-slate-500 text-sm font-medium uppercase tracking-wide">Desarrollo</p>
                    </div>
                </div>

                <div onclick="cargarNivel('IV')" class="min-w-[85%] md:min-w-[350px] snap-center bg-white rounded-3xl p-6 border border-slate-200 shadow-sm hover:shadow-xl hover:border-red-200 transition cursor-pointer group relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-green-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-green-100"></div>
                    <div class="relative z-10">
                        <div class="w-12 h-12 rounded-2xl bg-slate-100 text-slate-600 flex items-center justify-center text-xl mb-4 group-hover:bg-green-600 group-hover:text-white transition"><i class="fa-solid fa-graduation-cap"></i></div>
                        <h3 class="font-display text-2xl font-bold text-slate-900 mb-1">Practicum IV</h3>
                        <p class="text-slate-500 text-sm font-medium uppercase tracking-wide">Finalización</p>
                    </div>
                </div>

            </div>
            <p class="text-slate-400 text-sm text-center md:text-left animate-pulse"><i class="fa-solid fa-arrow-right"></i> Desliza o haz clic para seleccionar</p>
        </div>
    </div>

    <div class="relative lg:absolute lg:bottom-0 lg:right-0 w-full lg:w-auto flex flex-col items-center lg:items-end z-0 pointer-events-none">
        <img src="https://i.imgur.com/G6kesFp.png" 
             class="w-auto h-[350px] md:h-[500px] lg:h-[600px] object-contain drop-shadow-2xl translate-y-10 lg:translate-y-0"
             alt="Director">
        
        <div class="absolute bottom-6 left-6 lg:left-auto lg:right-12 lg:bottom-12 glass-card p-4 rounded-xl flex items-center gap-4 animate-fade-in shadow-xl max-w-[280px]">
            <div class="w-10 h-10 rounded-lg bg-slate-900 flex items-center justify-center text-white">
                <i class="fa-solid fa-user-tie"></i>
            </div>
            <div>
                <h4 class="font-display font-bold text-slate-900 text-sm leading-tight">M.Sc. Odín Rodriguez Mercado</h4>
                <p class="text-[10px] text-uagrm-red font-bold uppercase tracking-widest mt-0.5">Director de Carrera</p>
            </div>
        </div>
    </div>
  </div>

  <div id="tutors-view" class="hidden min-h-screen bg-slate-50 pb-20">
      <div class="max-w-6xl mx-auto px-6 py-10">
          <div class="flex justify-between items-center mb-10">
              <div>
                <h2 class="font-display text-3xl font-bold text-slate-900" id="titulo-nivel">Practicum</h2>
                <p class="text-slate-500">Docentes habilitados para este nivel</p>
              </div>
              <button onclick="volverInicio()" class="px-5 py-2 rounded-xl border border-slate-300 hover:bg-white hover:shadow-md transition text-sm font-bold text-slate-600">
                  <i class="fa-solid fa-arrow-left mr-2"></i> Volver
              </button>
          </div>

          <div id="lista-tutores" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              </div>
      </div>
  </div>

  <div id="modal" class="fixed inset-0 z-50 hidden">
      <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm transition-opacity" onclick="cerrarModal()"></div>
      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
          <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
              <div class="bg-slate-900 p-6 text-white relative">
                  <h3 class="font-display text-xl font-bold">Confirmar Solicitud</h3>
                  <p class="text-slate-400 text-sm mt-1">Practicum <span id="modal-nivel"></span></p>
                  <button onclick="cerrarModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
              </div>
              
              <div class="p-6">
                  <p class="text-sm text-slate-500 mb-4">Estás solicitando tutoría con:</p>
                  <div class="flex items-center gap-3 mb-6 p-3 bg-slate-50 rounded-xl border border-slate-100">
                      <div class="w-10 h-10 rounded-full bg-uagrm-red/10 text-uagrm-red flex items-center justify-center font-bold"><i class="fa-solid fa-chalkboard-user"></i></div>
                      <span class="font-bold text-slate-900" id="modal-tutor-nombre"></span>
                  </div>

                  <form id="formSolicitud" onsubmit="enviarSolicitud(event)">
                      <input type="hidden" id="input-tutor-id">
                      
                      <div class="space-y-4">
                          <div>
                              <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Nombre Completo</label>
                              <input type="text" id="input-nombre" required class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:outline-none focus:border-uagrm-red focus:ring-1 focus:ring-uagrm-red transition" placeholder="Ej: Juan Pérez">
                          </div>
                          <div>
                              <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Registro Universitario</label>
                              <input type="number" id="input-registro" required class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:outline-none focus:border-uagrm-red focus:ring-1 focus:ring-uagrm-red transition" placeholder="Ej: 219000000">
                          </div>
                          <div>
                              <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Cédula de Identidad</label>
                              <input type="text" id="input-carnet" required class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:outline-none focus:border-uagrm-red focus:ring-1 focus:ring-uagrm-red transition">
                          </div>
                      </div>

                      <button type="submit" class="w-full mt-8 py-4 bg-uagrm-red text-white font-bold rounded-xl shadow-lg shadow-red-200 hover:bg-red-700 hover:scale-[1.02] transition">
                          Generar Carta PDF
                      </button>
                  </form>
              </div>
          </div>
      </div>
  </div>

  <script>
    let nivelActual = "";

    function cargarNivel(nivel) {
        nivelActual = nivel;
        // Transición visual
        document.getElementById('main-view').classList.add('hidden');
        document.getElementById('tutors-view').classList.remove('hidden');
        document.getElementById('titulo-nivel').innerText = `Practicum ${nivel}`;
        window.scrollTo(0,0);
        
        fetchTutores();
    }

    function volverInicio() {
        document.getElementById('tutors-view').classList.add('hidden');
        document.getElementById('main-view').classList.remove('hidden');
        document.getElementById('lista-tutores').innerHTML = ''; 
    }

    async function fetchTutores() {
        const contenedor = document.getElementById('lista-tutores');
        contenedor.innerHTML = '<div class="col-span-3 text-center py-20"><div class="inline-block w-8 h-8 border-4 border-slate-200 border-t-uagrm-red rounded-full animate-spin"></div></div>';

        try {
            const res = await fetch(`/api/tutors?level=${nivelActual}`);
            const tutores = await res.json();
            
            contenedor.innerHTML = "";
            
            if(tutores.length === 0) {
                contenedor.innerHTML = '<div class="col-span-3 text-center text-slate-500">No hay docentes disponibles en este momento.</div>';
                return;
            }

            tutores.forEach(t => {
                const lleno = t.cupos_disponibles === 0;
                // Estilo tarjeta
                const card = document.createElement('div');
                card.className = `bg-white p-6 rounded-2xl border ${lleno ? 'border-slate-100 opacity-60' : 'border-slate-200 hover:border-uagrm-red hover:shadow-lg'} transition group relative overflow-hidden`;
                
                if(!lleno) {
                    card.onclick = () => abrirModal(t.id, t.name);
                    card.style.cursor = 'pointer';
                }

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 rounded-xl bg-slate-50 flex items-center justify-center text-lg text-slate-700 font-bold">
                            ${t.name.charAt(0)}
                        </div>
                        <span class="${lleno ? 'bg-slate-100 text-slate-400' : 'bg-green-100 text-green-700'} px-3 py-1 rounded-full text-xs font-bold">
                            ${lleno ? 'AGOTADO' : `${t.cupos_disponibles} Libres`}
                        </span>
                    </div>
                    <h3 class="font-display font-bold text-slate-900 text-lg mb-1 leading-tight">${t.name}</h3>
                    <div class="space-y-1 mt-4">
                        <p class="text-sm text-slate-500 flex items-center gap-2"><i class="fa-solid fa-phone text-xs"></i> ${t.phone}</p>
                        <p class="text-sm text-slate-500 flex items-center gap-2"><i class="fa-solid fa-envelope text-xs"></i> ${t.email}</p>
                    </div>
                    ${!lleno ? '<div class="absolute bottom-0 left-0 w-full h-1 bg-uagrm-red transform scale-x-0 group-hover:scale-x-100 transition duration-300"></div>' : ''}
                `;
                contenedor.appendChild(card);
            });

        } catch (error) {
            contenedor.innerHTML = '<div class="col-span-3 text-center text-red-500">Error de conexión.</div>';
        }
    }

    // Lógica Modal
    const modal = document.getElementById('modal');
    
    function abrirModal(id, nombre) {
        document.getElementById('input-tutor-id').value = id;
        document.getElementById('modal-tutor-nombre').innerText = nombre;
        document.getElementById('modal-nivel').innerText = nivelActual;
        modal.classList.remove('hidden');
    }

    function cerrarModal() {
        modal.classList.add('hidden');
    }

    async function enviarSolicitud(e) {
        e.preventDefault();
        const btn = e.target.querySelector('button');
        const txtOriginal = btn.innerText;
        btn.disabled = true;
        btn.innerText = "Procesando...";

        const datos = {
            tutor_id: parseInt(document.getElementById('input-tutor-id').value),
            nivel: nivelActual,
            nombre: document.getElementById('input-nombre').value,
            registro: document.getElementById('input-registro').value,
            carnet: document.getElementById('input-carnet').value
        };

        try {
            const res = await fetch('/api/solicitar', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(datos)
            });
            const json = await res.json();

            if (res.ok) {
                window.location.href = json.pdf_url;
                cerrarModal();
                fetchTutores(); // Recargar lista
                e.target.reset();
                alert("¡Solicitud Exitosa! Descargando carta...");
            } else {
                alert("Error: " + json.error);
            }
        } catch (err) {
            alert("Error de conexión");
        } finally {
            btn.disabled = false;
            btn.innerText = txtOriginal;
        }
    }
  </script>
</body>
</html>
