<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dinámica: Empresa (enfoque heterodoxo) — Santa Cruz</title>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme:{extend:{colors:{ink:'#0f172a',muted:'#64748b',line:'rgba(148,163,184,.25)',emerald:'#10b981',stone:'#2c3e50'}}}
    }
  </script>
  <style>
    body{background:#f7fafc}
    .glass{backdrop-filter:saturate(140%) blur(8px);} 
    .die{box-shadow:0 8px 20px rgba(2,6,23,.45), inset 0 0 24px rgba(16,185,129,.18)}
    .roll{animation:wiggle .6s ease-in-out}
    @keyframes wiggle{0%{transform:rotate(0) scale(1)}25%{transform:rotate(8deg) scale(1.05)}50%{transform:rotate(-6deg) scale(1.04)}75%{transform:rotate(4deg) scale(1.02)}100%{transform:rotate(0) scale(1)}}
    .pip-glow{color:#fff;text-shadow:0 0 10px rgba(255,255,255,.95),0 0 30px rgba(16,185,129,.85)}
    .badge{border:1px solid rgba(148,163,184,.35); background:linear-gradient(180deg,#fff,rgba(255,255,255,.6));}
    .chip{border:1px solid rgba(148,163,184,.35);}
    @media print {
      header, #controls, .no-print, .btn, .die, #grid button, #timerBox, #scorePanel .controls { display:none !important; }
      #summaryModal, #summaryContent { position:static !important; inset:auto !important; transform:none !important; box-shadow:none !important; }
      body{background:white}
    }
  </style>
</head>
<body class="min-h-screen text-slate-800">
  <!-- Header -->
  <header class="sticky top-0 z-20 bg-stone text-white border-b border-black/10">
    <div class="max-w-7xl mx-auto px-4 py-2 flex items-center justify-between">
      <div class="font-extrabold tracking-wide">Dinámica: Empresa y decisiones más allá del lucro</div>
      <div class="flex items-center gap-2">
        <button id="openSummary" class="no-print px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 text-white text-xs border border-white/20">Resumen & Exportar</button>
        <div class="text-xs opacity-90">Santa Cruz — Economía I</div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-4 grid gap-4 lg:grid-cols-12">
    <!-- Panel izquierdo: dado + control de ronda + score -->
    <section class="lg:col-span-4 grid gap-3">
      <div id="controls" class="rounded-2xl p-4 bg-white border border-line shadow-sm">
        <h2 class="text-sm font-semibold text-slate-600">Asignación aleatoria</h2>
        <div class="mt-3 flex items-center gap-4">
          <div id="die" role="button" tabindex="0" aria-label="Lanzar dado (clic o barra espaciadora)" class="die w-40 h-40 rounded-2xl bg-gradient-to-br from-slate-800 to-slate-900 border border-line grid place-items-center cursor-pointer select-none active:scale-95">
            <div id="pip" class="pip-glow text-[84px] leading-none">—</div>
          </div>
          <div class="text-xs text-muted">
            Clic o <kbd class="px-1 py-0.5 rounded bg-slate-800 text-white border border-line">Espacio</kbd> para lanzar. <br/>
            El número indica qué <span class="font-semibold">situación (1–3)</span> aplica a la empresa seleccionada.
          </div>
        </div>
        <div class="mt-3 flex items-center gap-2 text-xs">
          <label class="inline-flex items-center gap-2 select-none"><input id="includeContext" type="checkbox" class="accent-emerald-500"> Mostrar contexto al revelar</label>
        </div>
      </div>

      <div class="rounded-2xl p-4 bg-white border border-line shadow-sm">
        <h2 class="text-sm font-semibold text-slate-600">Ronda y tiempo</h2>
        <div class="mt-2 grid grid-cols-2 gap-2 text-sm">
          <div class="border border-line rounded-xl p-2">
            <div class="text-[11px] text-slate-500">Ronda</div>
            <div class="flex items-center gap-2 mt-1">
              <button id="prevRound" class="px-2 py-1 rounded-lg border border-line">−</button>
              <div id="round" class="min-w-8 text-center font-bold">1</div>
              <button id="nextRound" class="px-2 py-1 rounded-lg border border-line">＋</button>
            </div>
          </div>
          <div id="timerBox" class="border border-line rounded-xl p-2">
            <div class="text-[11px] text-slate-500">Cronómetro (min)</div>
            <div class="flex items-center gap-2 mt-1">
              <input id="mins" type="number" min="1" value="7" class="w-14 px-2 py-1 border border-line rounded"/>
              <button id="startTimer" class="px-3 py-1 rounded-lg bg-emerald text-white text-xs">Iniciar</button>
            </div>
            <div id="timer" class="mt-1 text-slate-600 text-sm">00:00</div>
          </div>
        </div>
        <p class="mt-3 text-[12px] text-slate-600">Criterios a equilibrar (no sólo utilidad): <span class="badge rounded-full px-2 py-0.5">Legitimidad</span> <span class="badge rounded-full px-2 py-0.5">Cumplimiento</span> <span class="badge rounded-full px-2 py-0.5">Trabajo</span> <span class="badge rounded-full px-2 py-0.5">Resiliencia</span> <span class="badge rounded-full px-2 py-0.5">Resultados</span></p>
      </div>

      <!-- Panel de puntuación -->
      <div id="scorePanel" class="rounded-2xl p-4 bg-white border border-line shadow-sm">
        <h2 class="text-sm font-semibold text-slate-700">Marcador de puntuación</h2>
        <div class="mt-2 grid gap-2">
          <div class="controls flex items-center gap-2">
            <label class="text-[12px] text-slate-600">Grupo</label>
            <select id="scoreGroup" class="text-sm border border-line rounded px-2 py-1"></select>
            <span class="chip text-[11px] rounded-full px-2 py-0.5">Ronda <span id="scoreRound">1</span></span>
          </div>
          <div class="grid grid-cols-1 gap-2">
            <div class="grid grid-cols-6 items-center gap-2 text-[12px]">
              <span>Legitimidad</span><input type="range" min="0" max="2" step="0.5" id="sc_leg"/><span id="vl_leg" class="text-right">0</span>
            </div>
            <div class="grid grid-cols-6 items-center gap-2 text-[12px]">
              <span>Cumplimiento</span><input type="range" min="0" max="2" step="0.5" id="sc_cum"/><span id="vl_cum" class="text-right">0</span>
            </div>
            <div class="grid grid-cols-6 items-center gap-2 text-[12px]">
              <span>Trabajo</span><input type="range" min="0" max="2" step="0.5" id="sc_tra"/><span id="vl_tra" class="text-right">0</span>
            </div>
            <div class="grid grid-cols-6 items-center gap-2 text-[12px]">
              <span>Resiliencia</span><input type="range" min="0" max="2" step="0.5" id="sc_res"/><span id="vl_res" class="text-right">0</span>
            </div>
            <div class="grid grid-cols-6 items-center gap-2 text-[12px]">
              <span>Resultados</span><input type="range" min="0" max="2" step="0.5" id="sc_resu"/><span id="vl_resu" class="text-right">0</span>
            </div>
          </div>
          <div class="flex items-center justify-between mt-1">
            <div class="text-sm">Total: <b><span id="scoreTotal">0</span> / 10</b></div>
            <button id="saveScore" class="px-3 py-1 rounded-lg bg-slate-900 text-white text-xs">Guardar puntaje</button>
          </div>
        </div>
      </div>

      <div class="rounded-2xl p-4 bg-white border border-line shadow-sm">
        <h2 class="text-sm font-semibold text-slate-700">Guía de análisis</h2>
        <ol class="text-[13px] list-decimal ml-5 mt-2 space-y-1">
          <li><b>Impacto económico</b>: costo, precio, volumen, caja.</li>
          <li><b>Factores extraeconómicos</b>: reputación, regulación, comunidad, trabajo.</li>
          <li><b>Decisión</b>: precio/volumen, inversión mínima, ajustes.</li>
          <li><b>Riesgos y compensaciones</b>.</li>
          <li><b>Mensaje público</b>: legitimidad de la medida.</li>
        </ol>
      </div>
    </section>

    <!-- Panel derecho: empresas y situaciones -->
    <section class="lg:col-span-8 grid gap-3">
      <div class="flex items-center justify-between">
        <h2 class="text-sm font-semibold text-slate-600">Empresas seleccionadas (5 grupos)</h2>
        <div class="text-xs text-muted">Haz clic en <em>Revelar</em> y luego lanza el dado (1–3).</div>
      </div>
      <div id="grid" class="grid gap-3 sm:grid-cols-2 xl:grid-cols-3">
        <!-- Tarjetas renderizadas por JS -->
      </div>
    </section>
  </main>

  <footer class="max-w-7xl mx-auto px-4 pb-6 text-[11px] text-slate-500">Docente: Daniel Hurtado Justiniano — Economía I</footer>

  <!-- Modal Resumen -->
  <div id="summaryModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/40" aria-hidden="true"></div>
    <div class="absolute left-1/2 top-10 -translate-x-1/2 w-[min(1100px,95vw)]">
      <div id="summaryContent" class="rounded-2xl bg-white border border-line shadow-xl">
        <div class="flex items-center justify-between p-3 border-b border-line">
          <h3 class="font-semibold text-slate-800 text-sm">Resumen de decisiones y puntuaciones</h3>
          <div class="no-print flex items-center gap-2">
            <button id="printBtn" class="px-3 py-1.5 rounded-lg bg-slate-900 text-white text-xs">Imprimir / PDF</button>
            <button id="closeSummary" class="px-3 py-1.5 rounded-lg border border-line text-xs">Cerrar</button>
          </div>
        </div>
        <div class="p-3">
          <div id="summaryBody" class="text-[12px] grid gap-3"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ======= Datos de las 5 empresas (forma + tres situaciones) =======
    const EMPRESAS = [
      { id:'unip', nombre:'Empresa Unipersonal', color:'from-emerald-400/25 to-emerald-500/10', contexto:'Negocio pequeño con gestión directa del titular; alta exposición a shocks personales y de flujo de caja.', situaciones:[
          'El titular enferma una semana y no puede abrir. No hay suplente. ¿Cómo sostener ingresos y clientela? ',
          'El alquiler sube 20%. Debe decidir entre subir precios, reducir surtido o trasladarse.',
          'Cliente grande pide crédito a 60 días; aceptar afecta caja. ¿Condiciones, límites y comunicación?'] },
      { id:'samA', nombre:'Sociedad Anónima Mixta — Grupo A', color:'from-sky-400/25 to-sky-500/10', contexto:'Empresa con participación estatal y privada; tensión entre objetivo social y rentabilidad.', situaciones:[
          'El socio estatal exige mantener tarifa baja por razones sociales. ¿Cómo compensar el menor ingreso?',
          'Inversionistas privados piden mayor rentabilidad en la junta. ¿Qué compromisos y plazos ofrecer?',
          'Auditoría pública detecta retrasos y amenaza sanciones. ¿Plan de corrección y comunicación?'] },
      { id:'samB', nombre:'Sociedad Anónima Mixta — Grupo B', color:'from-fuchsia-400/25 to-fuchsia-500/10', contexto:'Misma figura, distinto frente político-mediático; año sensible.', situaciones:[
          'Nueva norma ambiental exige tecnología costosa. ¿Escalonar inversión sin perder legitimidad? ',
          'Campaña mediática acusa favoritismo en contrataciones. ¿Proceso transparente y reparación?',
          'Debate sobre reinvertir utilidades vs. dividendos en año electoral. ¿Criterios y señal pública?'] },
      { id:'coop', nombre:'Cooperativa de Servicios', color:'from-indigo-400/25 to-indigo-500/10', contexto:'Gobernanza de socios-usuarios; prioridad de servicio y sostenibilidad financiera.', situaciones:[
          'Asamblea exige reducir tarifa en barrio popular; caída de ingresos. ¿Focalización y plan financiero?',
          'Reclamos por cortes repetidos; riesgo de protesta. ¿Calendario público y medidas? ',
          'Renovación de equipos requiere aumentar aportes; hay división interna. ¿Construir consenso?'] },
      { id:'srl', nombre:'Sociedad de Responsabilidad Limitada (SRL)', color:'from-amber-400/25 to-amber-500/10', contexto:'Propiedad cerrada hasta 25 socios; acuerdos internos claves.', situaciones:[
          'Dos socios discuten: reinvertir vs. repartir utilidades. ¿Reglas y horizonte? ',
          'Entrada de nuevos inversionistas limitada por el tope legal. ¿Alternativas contractuales?',
          'Proveedor clave ofrece exclusividad con restricciones. ¿Riesgo de dependencia y plan B?'] }
    ];

    // ======= Estado =======
    const RESPUESTAS = {}; // { empresaId: { [round]: {impacto:'', factores:'', decision:'', riesgos:'', mensaje:''} } }
    const SCORES = {};    // { empresaId: { [round]: {leg, cum, tra, res, resu, total} } }

    // ======= Render de tarjetas =======
    const grid = document.getElementById('grid');
    function formHTML(id){
      return `
      <div class="mt-2 border border-line rounded-xl p-3 grid gap-2">
        <div class="grid sm:grid-cols-2 gap-2">
          <label class="text-[12px]">Impacto económico<textarea id="f-imp-${id}" class="mt-1 w-full border border-line rounded p-2 text-[12px]" rows="2" placeholder="Costo, precio, volumen, caja…"></textarea></label>
          <label class="text-[12px]">Factores extraeconómicos<textarea id="f-fac-${id}" class="mt-1 w-full border border-line rounded p-2 text-[12px]" rows="2" placeholder="Reputación, regulación, comunidad, trabajo…"></textarea></label>
        </div>
        <label class="text-[12px]">Decisión<textarea id="f-dec-${id}" class="mt-1 w-full border border-line rounded p-2 text-[12px]" rows="2" placeholder="Precio/volumen, inversión mínima, ajustes…"></textarea></label>
        <div class="grid sm:grid-cols-2 gap-2">
          <label class="text-[12px]">Riesgos y compensaciones<textarea id="f-rie-${id}" class="mt-1 w-full border border-line rounded p-2 text-[12px]" rows="2"></textarea></label>
          <label class="text-[12px]">Mensaje público<textarea id="f-men-${id}" class="mt-1 w-full border border-line rounded p-2 text-[12px]" rows="2"></textarea></label>
        </div>
        <div class="flex items-center justify-end gap-2">
          <button data-act="guardar" data-id="${id}" class="btn px-3 py-1.5 rounded-lg bg-emerald text-white text-xs">Registrar decisión</button>
        </div>
      </div>`;
    }
    function cardHTML(e){
      return `
      <article id="${e.id}" class="relative rounded-2xl bg-white p-4 border border-line shadow-sm">
        <div class="absolute inset-y-0 left-0 w-1.5 rounded-l-2xl bg-gradient-to-b ${e.color}"></div>
        <h3 class="font-extrabold text-[15px] text-slate-800 flex items-center gap-2">
          <span class="inline-block w-2 h-2 rounded-full bg-gradient-to-r ${e.color}"></span>${e.nombre}
        </h3>
        <p class="mt-1 text-[12px] text-slate-600">${e.contexto}</p>
        <div class="mt-2 grid gap-2">
          <button data-act="revelar" data-id="${e.id}" class="px-3 py-1.5 rounded-lg bg-slate-900 text-white text-xs w-max">Revelar situación</button>
          <div class="text-[12px] text-slate-500">Lanza el dado (1–3) y luego presiona <em>Revelar</em>.</div>
          <div class="mt-1 text-[13px] hidden" id="box-${e.id}">
            <div class="rounded-xl p-3 border border-line bg-gradient-to-br ${e.color}">
              <div class="text-[11px] uppercase tracking-wide text-slate-700">Situación para esta ronda</div>
              <div class="mt-1 font-medium text-slate-900" id="text-${e.id}">—</div>
            </div>
            ${formHTML(e.id)}
          </div>
        </div>
      </article>`
    }
    function render(){ grid.innerHTML = EMPRESAS.map(cardHTML).join(''); }

    // ======= Dado y lógica =======
    const die = document.getElementById('die');
    const pip = document.getElementById('pip');
    let lastN = null; let rolling = false;
    function roll(){
      if(rolling) return; rolling = true; die.classList.add('roll');
      const steps = 12 + Math.floor(Math.random()*8); let i=0; let n=1;
      const timer = setInterval(()=>{
        n = 1 + Math.floor(Math.random()*3);
        pip.textContent = n; i++;
        if(i>=steps){ clearInterval(timer); die.classList.remove('roll'); rolling=false; lastN=n; }
      },55);
    }
    die.addEventListener('click', roll);
    window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); roll(); } });

    // ======= Helpers =======
    const roundEl = document.getElementById('round');
    const scoreRound = document.getElementById('scoreRound');
    function currentRound(){ return Number(roundEl.textContent)||1 }

    // Revelar situación según número del dado
    document.addEventListener('click', e=>{
      const btn = e.target.closest('button[data-act="revelar"]');
      if(!btn) return; const id = btn.dataset.id; const emp = EMPRESAS.find(x=>x.id===id);
      if(!lastN){ alert('Primero lanza el dado (1–3).'); return; }
      const idx = Math.max(1, Math.min(3, Number(lastN))) - 1;
      const box = document.getElementById('box-'+id);
      const text = document.getElementById('text-'+id);
      const showCtx = document.getElementById('includeContext').checked;
      text.textContent = (showCtx? '['+(idx+1)+'] ':'') + emp.situaciones[idx];
      box.classList.remove('hidden');
      document.getElementById(id).scrollIntoView({behavior:'smooth', block:'center'});
    });

    // Guardar decisiones
    document.addEventListener('click', e=>{
      const btn = e.target.closest('button[data-act="guardar"]');
      if(!btn) return; const id = btn.dataset.id; const r = currentRound();
      RESPUESTAS[id] ||= {}; RESPUESTAS[id][r] = {
        impacto: document.getElementById('f-imp-'+id).value.trim(),
        factores: document.getElementById('f-fac-'+id).value.trim(),
        decision: document.getElementById('f-dec-'+id).value.trim(),
        riesgos: document.getElementById('f-rie-'+id).value.trim(),
        mensaje: document.getElementById('f-men-'+id).value.trim(),
      };
      alert('Decisión guardada para '+id.toUpperCase()+', ronda '+r+'.');
    });

    // ======= Ronda y timer =======
    document.getElementById('prevRound').onclick = ()=>{ roundEl.textContent = Math.max(1, Number(roundEl.textContent)-1); scoreRound.textContent = roundEl.textContent; };
    document.getElementById('nextRound').onclick = ()=>{ roundEl.textContent = Number(roundEl.textContent)+1; scoreRound.textContent = roundEl.textContent; };

    let tInt=null, remaining=0;
    const timerEl = document.getElementById('timer');
    function fmt(s){ const m=Math.floor(s/60), r=s%60; return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}` }
    document.getElementById('startTimer').onclick = ()=>{
      const mins = Math.max(1, Number(document.getElementById('mins').value)||7);
      remaining = mins*60; clearInterval(tInt); timerEl.textContent = fmt(remaining);
      tInt = setInterval(()=>{ remaining--; timerEl.textContent = fmt(Math.max(0,remaining)); if(remaining<=0){ clearInterval(tInt); timerEl.textContent='¡Tiempo!'; } },1000);
    };

    // ======= Puntuación =======
    const scoreGroup = document.getElementById('scoreGroup');
    function fillGroupSelect(){
      scoreGroup.innerHTML = EMPRESAS.map(e=>`<option value="${e.id}">${e.nombre}</option>`).join('');
    }
    ['sc_leg','sc_cum','sc_tra','sc_res','sc_resu'].forEach(k=>{
      const el = document.getElementById(k); const out = document.getElementById('vl_'+k.split('_')[1]);
      el.addEventListener('input',()=>{ out.textContent = el.value; updateTotal(); });
    });
    function updateTotal(){
      const vals = ['sc_leg','sc_cum','sc_tra','sc_res','sc_resu'].map(id=>Number(document.getElementById(id).value||0));
      const total = vals.reduce((a,b)=>a+b,0);
      document.getElementById('scoreTotal').textContent = total.toFixed(1).replace('.0','');
      return total;
    }
    document.getElementById('saveScore').onclick = ()=>{
      const g = scoreGroup.value; const r = currentRound(); const total = updateTotal();
      SCORES[g] ||= {}; SCORES[g][r] = {
        leg:Number(sc_leg.value), cum:Number(sc_cum.value), tra:Number(sc_tra.value), res:Number(sc_res.value), resu:Number(sc_resu.value), total:Number(total.toFixed(1))
      };
      alert('Puntaje guardado para '+g.toUpperCase()+', ronda '+r+'.');
    };

    // ======= Resumen & Exportar =======
    const openSummary = document.getElementById('openSummary');
    const closeSummary = document.getElementById('closeSummary');
    const printBtn = document.getElementById('printBtn');
    const summaryModal = document.getElementById('summaryModal');
    const summaryBody = document.getElementById('summaryBody');

    function sectionEmpresaHTML(emp){
      const rKeys = new Set([...(RESPUESTAS[emp.id]?Object.keys(RESPUESTAS[emp.id]):[]), ...(SCORES[emp.id]?Object.keys(SCORES[emp.id]):[])]);
      const rounds = [...rKeys].sort((a,b)=>Number(a)-Number(b));
      if(rounds.length===0) return `<div class="text-slate-500 text-[12px]">(Sin datos todavía)</div>`;
      return rounds.map(r=>{
        const D = (RESPUESTAS[emp.id]||{})[r]||{}; const S = (SCORES[emp.id]||{})[r]||{};
        return `
        <div class="rounded-xl border border-line">
          <div class="px-3 py-2 bg-slate-50 flex items-center justify-between">
            <div class="text-[12px]"><b>Ronda ${r}</b></div>
            <div class="text-[11px]">Puntaje: <b>${S.total??'-'}/10</b> <span class="text-slate-500">(Leg ${S.leg??'-'}, Cum ${S.cum??'-'}, Tra ${S.tra??'-'}, Resil ${S.res??'-'}, Result ${S.resu??'-'})</span></div>
          </div>
          <div class="grid md:grid-cols-2 gap-2 p-3 text-[12px]">
            <div><b>Impacto</b><div class="mt-0.5 whitespace-pre-wrap">${D.impacto||'—'}</div></div>
            <div><b>Factores extraeconómicos</b><div class="mt-0.5 whitespace-pre-wrap">${D.factores||'—'}</div></div>
            <div><b>Decisión</b><div class="mt-0.5 whitespace-pre-wrap">${D.decision||'—'}</div></div>
            <div><b>Riesgos y compensaciones</b><div class="mt-0.5 whitespace-pre-wrap">${D.riesgos||'—'}</div></div>
            <div class="md:col-span-2"><b>Mensaje público</b><div class="mt-0.5 whitespace-pre-wrap">${D.mensaje||'—'}</div></div>
          </div>
        </div>`
      }).join('');
    }
    function buildSummary(){
      summaryBody.innerHTML = EMPRESAS.map(emp=>`
        <section class="rounded-2xl border border-line">
          <div class="px-3 py-2 bg-white flex items-center justify-between rounded-t-2xl">
            <h4 class="font-semibold text-slate-800 text-sm">${emp.nombre}</h4>
            <span class="text-[11px] text-slate-500">${emp.contexto}</span>
          </div>
          <div class="p-3 grid gap-2">${sectionEmpresaHTML(emp)}</div>
        </section>
      `).join('');
    }

    openSummary.addEventListener('click', ()=>{ buildSummary(); summaryModal.classList.remove('hidden'); });
    closeSummary.addEventListener('click', ()=> summaryModal.classList.add('hidden'));
    printBtn.addEventListener('click', ()=>{ window.print(); });

    // ======= Init =======
    function render(){ grid.innerHTML = EMPRESAS.map(cardHTML).join(''); }
    render();
    const scoreGroupEl = document.getElementById('scoreGroup');
    function initScore(){ scoreGroupEl.innerHTML = EMPRESAS.map(e=>`<option value="${e.id}">${e.nombre}</option>`).join(''); updateTotal(); }
    initScore();
    pip.textContent = '—';
  </script>
</body>
</html>
