<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Análisis Estructural: Handbook on International Economic Law</title>
<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
  :root {
    --bg-body: #f8f9fa;
    --sidebar-bg: #ffffff;
    --text-main: #212529;
    --text-muted: #6c757d;
    --accent: #2c3e50;
    --border: #dee2e6;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --sidebar-width: 450px;
  }

  * { box-sizing: border-box; }

  body {
    font-family: 'Roboto', sans-serif;
    margin: 0; padding: 0;
    height: 100vh;
    height: 100dvh; /* Mobile fix */
    display: flex;
    background-color: var(--bg-body);
    color: var(--text-main);
    overflow: hidden;
  }

  /* --- SIDEBAR --- */
  .sidebar {
    width: var(--sidebar-width);
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    box-shadow: var(--shadow);
    z-index: 100;
    transition: transform 0.3s ease-in-out;
    height: 100%;
    position: relative;
  }

  .header {
    padding: 20px 25px;
    background: #1a202c;
    color: white;
    border-bottom: 3px solid #e2e8f0;
  }

  .header h1 {
    font-family: 'Merriweather', serif;
    font-size: 1.1rem;
    margin: 0 0 5px 0;
    line-height: 1.4;
    font-weight: 700;
  }

  .header .author {
    font-size: 0.75rem;
    color: #a0aec0;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .content-area {
    flex-grow: 1;
    overflow-y: auto;
    padding: 25px;
    -webkit-overflow-scrolling: touch;
  }

  /* Estilos de la información detallada */
  .detail-header {
    border-bottom: 1px solid var(--border);
    padding-bottom: 15px;
    margin-bottom: 20px;
  }

  .detail-title {
    font-family: 'Merriweather', serif;
    font-size: 1.4rem;
    color: #1a202c;
    margin: 0 0 5px 0;
  }

  .detail-meta {
    font-size: 0.75rem;
    font-weight: 700;
    color: #4a5568;
    text-transform: uppercase;
    background: #edf2f7;
    padding: 2px 6px;
    border-radius: 4px;
    display: inline-block;
  }

  .section-block { margin-bottom: 25px; }
  
  .section-title {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #718096;
    font-weight: 700;
    margin-bottom: 8px;
    border-left: 3px solid #2d3748;
    padding-left: 8px;
  }

  .section-content {
    font-size: 0.95rem;
    line-height: 1.6;
    color: #2d3748;
    text-align: justify;
  }

  .mechanism-box {
    background: #f0fff4;
    border: 1px solid #bbf7d0;
    border-radius: 6px;
    padding: 12px;
    margin-top: 10px;
  }

  .data-box {
    background: #fff7ed;
    border: 1px solid #fed7aa;
    border-radius: 6px;
    padding: 12px;
    margin-top: 10px;
  }
  
  .ref-text {
    font-family: 'Merriweather', serif;
    font-style: italic;
    font-size: 0.85rem;
    color: #4a5568;
  }

  /* --- NETWORK AREA --- */
  #network-wrapper {
    flex-grow: 1;
    position: relative;
    height: 100%;
    width: 100%;
    background-color: #f8fafc;
  }

  #network {
    width: 100%; height: 100%;
  }

  /* --- CONTROLES Y RESPONSIVE --- */
  .toggle-btn {
    display: none; /* Solo visible en mobile */
    position: absolute;
    top: 15px; left: 15px;
    z-index: 110;
    background: #1a202c;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 25px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    font-weight: bold;
    font-size: 0.9rem;
    cursor: pointer;
  }

  .controls {
    position: absolute; bottom: 20px; right: 20px;
    z-index: 105;
    display: flex; gap: 10px;
  }

  .ctrl-btn {
    background: white; border: 1px solid #cbd5e0;
    padding: 8px 12px; border-radius: 4px;
    font-size: 0.8rem; font-weight: 600;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transition: all 0.2s;
  }
  .ctrl-btn:hover { background: #f7fafc; transform: translateY(-1px); }

  /* MEDIA QUERIES */
  @media (max-width: 900px) {
    .sidebar {
      position: absolute;
      width: 100%;
      transform: translateX(-100%);
    }
    .sidebar.active {
      transform: translateX(0);
    }
    .toggle-btn { display: block; }
  }

</style>
</head>
<body>

<!-- BOTÓN MÓVIL -->
<button class="toggle-btn" onclick="toggleSidebar()" id="toggleBtn">
  Ver Análisis
</button>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <div class="header">
    <h1>Routledge Handbook on International Economic Law</h1>
    <div class="author">Análisis: Ricardo Alonzo Fernández Salguero</div>
  </div>

  <div class="content-area" id="infoPanel">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 80%; color: #a0aec0; text-align: center; padding: 20px;">
      <svg width="40" height="40" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
      <p style="margin-top: 15px; font-family: 'Merriweather', serif;">Seleccione un nodo en el gráfico para ver el análisis detallado del capítulo, mecanismos y evidencia.</p>
    </div>
  </div>
</div>

<!-- NETWORK -->
<div id="network-wrapper">
  <div id="network"></div>
  <div class="controls">
    <button class="ctrl-btn" onclick="fitNetwork()">⌖ Centrar</button>
    <button class="ctrl-btn" onclick="togglePhysics()" id="physBtn">❄ Congelar</button>
  </div>
</div>

<script>
// --- DATOS DEL ANÁLISIS ---
const analysisData = {
  1: {
    title: "Fundamentos: Historia y Teoría",
    type: "Parte I: Contexto",
    mechanism: "MACRO: Evolución Institucional",
    mech_desc: "Evolución desde el mercantilismo y Westfalia (1648) hasta el sistema de Bretton Woods (1944). El mecanismo causal es el cambio de un orden basado en la soberanía absoluta a uno de interdependencia económica para evitar la guerra.",
    evidence: "Vandevelde (Cap. 2) cita la creación del FMI y el Banco Mundial en 1944 y el fracaso de la OIC en 1948 como puntos de inflexión. Vadi (Cap. 3) señala cómo el IEL no puede aislarse del derecho internacional público general (Art. 38 Estatuto CIJ).",
    ref: "Vadi & Collins (Intro); Vandevelde (Cap. 2); Vadi (Cap. 3)"
  },
  2: {
    title: "La Organización Mundial del Comercio (OMC)",
    type: "Parte II: Comercio",
    mechanism: "MESO: Institucionalización y Adjudicación",
    mech_desc: "La transición del GATT (acuerdo provisional) a la OMC (organización con personalidad jurídica) fortaleció el mecanismo de solución de disputas, pasando de diplomacia a cuasi-judicialización.",
    evidence: "Sarmiento & Gómez (Cap. 5) detallan la membresía de 164 estados. Van den Bossche (Cap. 6) analiza la crisis del Órgano de Apelación desde 2019 debido al bloqueo de EE.UU., evidenciando la fragilidad institucional ante tensiones geopolíticas.",
    ref: "Sarmiento/Gomez (Cap. 5); Van den Bossche (Cap. 6)"
  },
  3: {
    title: "Subsidios y el Desafío de China",
    type: "Parte II: Comercio",
    mechanism: "MACRO: Capitalismo de Estado vs. Mercado",
    mech_desc: "El Acuerdo SCM asume economías de mercado. El mecanismo de fricción es la incompatibilidad de las reglas actuales con el modelo de 'Capitalismo de Estado' donde las Empresas Propiedad del Estado (SOEs) actúan como entes públicos.",
    evidence: "Ming Du (Cap. 10) cita que de 1995 a 2024, se impusieron 159 medidas compensatorias contra China (más de 1/3 del total mundial). El caso 'US–Anti-Dumping and Countervailing Duties' (DS379) redefinió 'organismo público' basándose en la autoridad gubernamental.",
    ref: "Ming Du (Cap. 10)"
  },
  4: {
    title: "Comercio Digital",
    type: "Parte II: Comercio (Nuevas Fronteras)",
    mechanism: "MICRO/MESO: Adaptación Normativa Fragmentada",
    mech_desc: "Ante la lentitud multilateral (OMC), el mecanismo de regulación se desplaza a Acuerdos Comerciales Regionales (RTAs) y Digital Economy Agreements (DEAs).",
    evidence: "Collins (Cap. 17) señala que la economía digital es >15% del PIB global. Cita el CPTPP y el USMCA como estándares 'gold' que prohíben la localización de datos, en contraste con el enfoque de soberanía digital de China.",
    ref: "David Collins (Cap. 17)"
  },
  5: {
    title: "Acuerdos Comerciales Regionales (RTAs)",
    type: "Parte II: Regionalismo",
    mechanism: "MACRO: Cambio de Pax Americana a Multipolaridad",
    mech_desc: "Proliferación de RTAs como respuesta al estancamiento de la Ronda de Doha. Mecanismo de 'Spaghetti Bowl' y competencia geopolítica.",
    evidence: "Claussen & Hsieh (Cap. 18) citan 371 RTAs en vigor (Mayo 2024). Destacan el RCEP (30% del PIB global) y el AfCFTA (mercado de 1.2 mil millones de personas) como ejemplos de integración Sur-Sur.",
    ref: "Claussen & Hsieh (Cap. 18)"
  },
  6: {
    title: "Derecho Internacional de Inversiones (IIAs)",
    type: "Parte III: Inversión",
    mechanism: "MICRO: Arbitraje Inversor-Estado (ISDS)",
    mech_desc: "Protección mediante tratados bilaterales (BITs) que permiten a privados demandar a Estados. Mecanismo de 'despolitización' de disputas.",
    evidence: "Moloo & Monti (Cap. 19) y De Brabandere (Cap. 21) señalan más de 3,000 BITs y 1,332 casos ISDS conocidos (UNCTAD). Se discute la legitimidad y el 'chilling effect' regulatorio.",
    ref: "Moloo/Monti (Cap. 19); De Brabandere (Cap. 21)"
  },
  7: {
    title: "Derecho a Regular y Expropiación",
    type: "Parte III: Inversión",
    mechanism: "MESO: Doctrina de Poderes de Policía",
    mech_desc: "Tensión entre protección de inversiones y soberanía estatal. El mecanismo legal es la distinción entre expropiación compensable y regulación no compensable (police powers).",
    evidence: "Shirlow (Cap. 24) y Gazzini (Cap. 25) analizan el caso 'Philip Morris v. Uruguay' donde medidas de salud pública fueron validadas bajo poderes de policía, redefiniendo el equilibrio inversor-estado.",
    ref: "Shirlow (Cap. 24); Gazzini (Cap. 25)"
  },
  8: {
    title: "Deuda Soberana y Arquitectura Financiera",
    type: "Parte IV: Finanzas",
    mechanism: "MACRO: Reestructuración Contractual vs. Estatutaria",
    mech_desc: "Ausencia de un mecanismo de quiebra soberana. El sistema depende de Cláusulas de Acción Colectiva (CACs) y foros informales (Club de París) para resolver crisis de deuda.",
    evidence: "Farah Yacoub et al. (Cap. 26) muestran que el 52% de los bonos soberanos se rigen por la ley de Nueva York. Citan el Marco Común del G20 como respuesta insuficiente a la nueva diversidad de acreedores (e.g., China).",
    ref: "Farah Yacoub et al. (Cap. 26)"
  },
  9: {
    title: "FMI y Derechos Humanos: Caso Argentina",
    type: "Parte IV: Finanzas y DDHH",
    mechanism: "MICRO: Condicionalidad y Austeridad",
    mech_desc: "Las condiciones de los préstamos del FMI (austeridad fiscal) impactan negativamente los derechos económicos y sociales (DESC).",
    evidence: "Attaguile et al. (Cap. 27) presentan datos de Argentina: el préstamo Stand-By de 2018 (el más grande de la historia) coincidió con un aumento de la pobreza y una caída del salario mínimo real (Fig 27.1).",
    ref: "Attaguile, Bohoslavsky & Kozulj (Cap. 27)"
  },
  10: {
    title: "Comercio y Cambio Climático",
    type: "Parte V: Intersecciones",
    mechanism: "MESO: Ajuste en Frontera y Subsidios Verdes",
    mech_desc: "Uso de herramientas comerciales (aranceles, subsidios) para objetivos climáticos. Tensión con normas OMC (no discriminación).",
    evidence: "Foster (Cap. 16) y Kent (Cap. 31) discuten el CBAM de la UE como medida unilateral y la necesidad de una interpretación evolutiva del Art. XX del GATT para permitir subsidios a energías renovables.",
    ref: "Foster (Cap. 16); Kent (Cap. 31)"
  },
  11: {
    title: "Sur Global y Reforma del Orden Económico",
    type: "Parte V: Desarrollo",
    mechanism: "MACRO: Contestación Normativa",
    mech_desc: "El Sur Global busca reformar el sistema (inversión y comercio) para incluir objetivos de desarrollo, o crear sistemas paralelos (regionalismo).",
    evidence: "Ngangjoh Hodu (Cap. 30) cita la Doctrina Calvo y el Nuevo Orden Económico Internacional (NIEO) como antecedentes. Destaca el AfCFTA como ejemplo de emancipación regional y desarrollo normativo propio.",
    ref: "Ngangjoh Hodu (Cap. 30)"
  }
};

// --- ESTRUCTURA DE LA RED ---
const nodes = new vis.DataSet([
  { id: 1, label: "Historia y Teoría\n(Fundamentos)", group: "theory", shape: "box", margin: 10 },
  { id: 2, label: "OMC\n(Institucional)", group: "trade", shape: "ellipse" },
  { id: 3, label: "Subsidios China\n(SCM Agreement)", group: "trade", shape: "box" },
  { id: 4, label: "Comercio Digital\n(Datos/E-comm)", group: "trade", shape: "box" },
  { id: 5, label: "RTAs\n(Regionalismo)", group: "trade", shape: "ellipse" },
  { id: 6, label: "Arbitraje ISDS\n(Procedimiento)", group: "invest", shape: "ellipse" },
  { id: 7, label: "Expropiación y\nRegulación", group: "invest", shape: "box" },
  { id: 8, label: "Deuda Soberana\n(Arquitectura Fin.)", group: "finance", shape: "ellipse" },
  { id: 9, label: "FMI y DDHH\n(Caso Argentina)", group: "finance", shape: "box" },
  { id: 10, label: "Cambio Climático\n(Medio Ambiente)", group: "link", shape: "diamond", size: 25 },
  { id: 11, label: "Sur Global\n(Desarrollo)", group: "link", shape: "diamond", size: 25 }
]);

const edges = new vis.DataSet([
  // Conexiones desde Teoría
  { from: 1, to: 2, label: "Evolución", arrows: "to" },
  { from: 1, to: 6, label: "Derecho Consuetudinario", arrows: "to", dashes: true },
  
  // Conexiones Comercio
  { from: 2, to: 3, label: "Reglas SCM", arrows: "to" },
  { from: 2, to: 5, label: "Multilateral vs Regional", arrows: "to" },
  { from: 4, to: 5, label: "Reglas en RTAs", arrows: "to" },
  
  // Conexiones Inversión
  { from: 6, to: 7, label: "Jurisprudencia", arrows: "to" },
  
  // Conexiones Finanzas
  { from: 8, to: 9, label: "Condicionalidad", arrows: "to" },
  
  // Conexiones Interseccionales (Links)
  { from: 3, to: 10, label: "Subsidios Verdes", arrows: "to", color: {color: 'green'} },
  { from: 5, to: 11, label: "AfCFTA/RCEP", arrows: "to" },
  { from: 7, to: 10, label: "Derecho a Regular", arrows: "to", dashes: true },
  { from: 9, to: 11, label: "Impacto Desarrollo", arrows: "to" }
]);

// --- CONFIGURACIÓN DE VIS.JS ---
const container = document.getElementById('network');
const data = { nodes: nodes, edges: edges };
const options = {
  nodes: {
    font: { size: 14, face: 'Roboto', color: '#333' },
    borderWidth: 2,
    shadow: true
  },
  edges: {
    width: 1.5,
    color: { color: '#bdc3c7', highlight: '#2c3e50' },
    font: { size: 10, align: 'middle', background: 'rgba(255,255,255,0.7)' },
    smooth: { type: 'continuous' }
  },
  groups: {
    theory: { color: { background: '#e2e8f0', border: '#4a5568' } },   /* Gris */
    trade: { color: { background: '#bee3f8', border: '#3182ce' } },    /* Azul */
    invest: { color: { background: '#feebc8', border: '#dd6b20' } },   /* Naranja */
    finance: { color: { background: '#fed7d7', border: '#e53e3e' } },  /* Rojo */
    link: { color: { background: '#c6f6d5', border: '#38a169' } }      /* Verde */
  },
  physics: {
    enabled: true,
    solver: 'forceAtlas2Based',
    forceAtlas2Based: {
      gravitationalConstant: -80,
      centralGravity: 0.005,
      springLength: 200,
      springConstant: 0.05
    },
    stabilization: { iterations: 150 }
  },
  interaction: { hover: true }
};

const network = new vis.Network(container, data, options);

// --- INTERACCIÓN ---
network.on("click", function (params) {
  if (params.nodes.length > 0) {
    const nodeId = params.nodes[0];
    const info = analysisData[nodeId];
    
    // En mobile, abrir el sidebar si está cerrado
    const sidebar = document.getElementById('sidebar');
    if (window.innerWidth <= 900) {
      sidebar.classList.add('active');
      document.getElementById('toggleBtn').innerText = "Cerrar Panel";
    }

    if (info) {
      document.getElementById('infoPanel').innerHTML = `
        <div class="detail-header">
          <span class="detail-meta">${info.type}</span>
          <h2 class="detail-title">${info.title}</h2>
        </div>
        
        <div class="section-block">
          <div class="section-title">MECANISMO CAUSAL</div>
          <div class="section-content">
            <strong>${info.mechanism}</strong><br>
            ${info.mech_desc}
          </div>
        </div>

        <div class="section-block data-box">
          <div class="section-title" style="color:#c05621; border-color:#c05621;">EVIDENCIA / DATOS</div>
          <div class="section-content">
            ${info.evidence}
          </div>
        </div>

        <div class="section-block">
          <div class="ref-text">Fuente: ${info.ref}</div>
        </div>
      `;
    }
  } else {
    // Click en vacío, cerrar sidebar en móvil
    if (window.innerWidth <= 900) {
      document.getElementById('sidebar').classList.remove('active');
      document.getElementById('toggleBtn').innerText = "Ver Análisis";
    }
  }
});

// Función para toggle sidebar en móvil
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const btn = document.getElementById('toggleBtn');
  
  if (sidebar.classList.contains('active')) {
    sidebar.classList.remove('active');
    btn.innerText = "Ver Análisis";
  } else {
    sidebar.classList.add('active');
    btn.innerText = "Cerrar Panel";
  }
}

// Función para centrar el grafo
function fitNetwork() {
  network.fit({ animation: { duration: 1000, easingFunction: 'easeInOutQuad' } });
}

// Función para congelar físicas
let physicsOn = true;
function togglePhysics() {
  physicsOn = !physicsOn;
  network.setOptions({ physics: { enabled: physicsOn } });
  const btn = document.getElementById('physBtn');
  btn.innerText = physicsOn ? "❄ Congelar" : "▶ Reanudar";
  btn.style.background = physicsOn ? "white" : "#e2e8f0";
}

</script>
</body>
</html>