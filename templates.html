<!doctype html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CIRCPyCS — Visor de Imágenes</title>
  <meta name="description" content="Galería y visor de imágenes del Centro de Investigación Regional en Ciencia Política y Ciencias Sociales — UAGRM" />
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --brand-blue:#313657; /* azul institucional */
      --brand-red:#d20b18;  /* rojo institucional */
      --brand-green:#007a3d;/* verde institucional */
      --ink:#e6eef7;     /* texto */
      --muted:#aab4d2;   /* secundario */
      --bg:#0b1220;      /* fondo */
      --panel:#0f1730;   /* tarjetas */
      --line:rgba(255,255,255,.08);
      --soft:0 10px 32px rgba(2,6,23,.28);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial;background:linear-gradient(180deg,var(--bg),#111a33 60%, var(--bg));color:var(--ink)}
    a{color:inherit}
    header{position:sticky;top:0;z-index:20;backdrop-filter:saturate(1.1) blur(10px);background:linear-gradient(180deg,rgba(17,25,46,.9),rgba(17,25,46,.6));border-bottom:1px solid var(--line)}
    .wrap{max-width:1200px;margin:0 auto;padding:14px 16px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{display:grid;place-items:center;width:36px;height:36px;border-radius:10px;background:conic-gradient(from 210deg,var(--brand-blue), var(--brand-red) 40%, var(--brand-green) 80%, var(--brand-blue));border:1px solid var(--line)}
    .title{font-weight:800;letter-spacing:.4px}

    .tools{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center}
    .pill{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:999px;padding:6px 10px}
    .search{flex:1;min-width:220px;display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:12px;padding:8px 10px}
    .search input{flex:1;background:transparent;border:0;outline:0;color:var(--ink)}
    .select{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:10px;padding:8px 10px;color:var(--ink)}
    #toggleFrame{accent-color:var(--brand-red)}
    #styleSel{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:10px;padding:8px 10px;color:var(--ink)}
    #overlayText{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:10px;padding:8px 10px;color:var(--ink);min-width:240px}

    main{max-width:1200px;margin:16px auto 40px;padding:0 16px}
    /* Masonry con columnas */
    .gallery{columns:1;column-gap:14px}
    @media(min-width:540px){.gallery{columns:2}}
    @media(min-width:900px){.gallery{columns:3}}
    @media(min-width:1200px){.gallery{columns:4}}
    .card{break-inside:avoid;margin:0 0 14px;background:var(--panel);border:1px solid var(--line);border-radius:14px;overflow:hidden;box-shadow:var(--soft)}
    .thumb{display:block;width:100%;height:auto;background:#0a0f1f}
    .meta{padding:10px 12px;border-top:1px solid var(--line);display:flex;justify-content:space-between;gap:8px;align-items:center}
    .meta h3{margin:0;font-size:14px;font-weight:700;letter-spacing:.2px}
    .tags{display:flex;gap:6px;flex-wrap:wrap}
    .tag{font-size:11px;color:var(--muted);background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:999px;padding:3px 8px}
    .btn{cursor:pointer;border:1px solid var(--line);background:linear-gradient(180deg, var(--brand-blue), #151c33);color:var(--ink);padding:8px 10px;border-radius:10px}
    .btn:hover{border-color:rgba(255,255,255,.25)}

    /* Lightbox */
    .lightbox{position:fixed;inset:0;background:rgba(5,8,16,.8);display:none;align-items:center;justify-content:center;padding:20px;z-index:40}
    .lightbox.open{display:flex}
    .viewer{position:relative;max-width:96vw;max-height:86vh;background:#0a0f1f;border:1px solid var(--line);border-radius:16px;box-shadow:var(--soft);overflow:hidden}
    .viewer img{display:block;max-width:100%;max-height:86vh}
    .frame-overlay{pointer-events:none;position:absolute;inset:0}
    .vbar{position:absolute;left:0;right:0;bottom:0;background:linear-gradient(180deg,rgba(9,14,28,.0),rgba(9,14,28,.9));padding:12px;border-top:1px solid var(--line);display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between}
    .vbar .info{display:flex;gap:10px;align-items:center}
    .vbar h3{margin:0;font-size:14px}
    .chip{font-size:11px;color:var(--muted);border:1px solid var(--line);border-radius:999px;padding:3px 8px;background:rgba(255,255,255,.04)}
    .navbtn{position:absolute;top:50%;transform:translateY(-50%);width:44px;height:44px;border-radius:50%;border:1px solid var(--line);background:rgba(255,255,255,.06);cursor:pointer;display:grid;place-items:center}
    .navbtn:hover{background:rgba(255,255,255,.12)}
    .prev{left:-62px}
    .next{right:-62px}
    .close{position:absolute;top:-54px;right:0}

    footer{max-width:1200px;margin:20px auto 40px;padding:0 16px;color:var(--muted);font-size:14px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">CIRCPyCS — Visor de Imágenes</div>
          <div style="font-size:12px;color:var(--muted)">Galería institucional (eventos, publicaciones, proyectos)</div>
        </div>
      </div>
      <div class="tools" role="region" aria-label="Herramientas de filtrado y búsqueda">
        <div class="search" style="flex:1">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/></svg>
          <input id="q" type="search" placeholder="Buscar por título, etiqueta..." aria-label="Buscar" />
        </div>
        <select id="category" class="select" aria-label="Filtrar por categoría">
          <option value="">Todas las categorías</option>
          <option>Eventos</option>
          <option>Publicaciones</option>
          <option>Proyectos</option>
          <option>Equipo</option>
          <option>Comunicados</option>
          <option>Multimedia</option>
        </select>
        <select id="sort" class="select" aria-label="Ordenar">
          <option value="new">Más recientes</option>
          <option value="old">Más antiguas</option>
          <option value="az">A → Z</option>
          <option value="za">Z → A</option>
        </select>
        <label class="pill" style="cursor:pointer"><input id="toggleFrame" type="checkbox" style="margin-right:6px"> Marcos</label>
        <select id="styleSel" aria-label="Estilo de marco">
          <option value="clasico">Clásico (borde + esquinas)</option>
          <option value="homenaje_bottom" selected>Homenaje — Banda inferior</option>
          <option value="homenaje_top">Homenaje — Cinta superior</option>
          <option value="logo_corner">Placa con logo</option>
          <option value="lateral_verde">Lateral verde</option>
        </select>
        <input id="overlayText" type="text" value="Homenaje Isaac Sandoval Rodriguez" aria-label="Texto del homenaje" />
      </div>
    </div>
  </header>

  <main>
    <div id="gallery" class="gallery" aria-live="polite"></div>
  </main>

  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
    <button class="btn close" id="close">Cerrar ✕</button>
    <button class="navbtn prev" id="prev" aria-label="Anterior">‹</button>
    <div class="viewer">
      <img id="viewImg" alt="" />
      <!-- Marco SVG superpuesto -->
      <svg id="frameOverlay" class="frame-overlay" viewBox="0 0 1080 1080" preserveAspectRatio="none" aria-hidden="true"></svg>
      <div class="vbar">
        <div class="info">
          <h3 id="viewTitle"></h3>
          <span id="viewCat" class="chip"></span>
          <span id="viewDate" class="chip"></span>
        </div>
        <div class="actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <a id="downloadOriginal" class="btn" download>Descargar original</a>
          <button id="downloadFramed" class="btn" style="background:linear-gradient(180deg,var(--brand-green), #152a1f)">Descargar con marco (1080×1080)</button>
          <button id="copyLink" class="btn" style="background:linear-gradient(180deg,var(--brand-red), #2a1518)">Copiar enlace</button>
          <label class="pill" style="gap:6px"><input id="toggleLogo" type="checkbox" checked> Incluir logo</label>
        </div>
      </div>
    </div>
    <button class="navbtn next" id="next" aria-label="Siguiente">›</button>
  </div>

  <footer>
    <p><strong>Nota CORS:</strong> esta demo usa imágenes de Imgur. Para que <em>Descargar con marco</em> funcione siempre, sirve las imágenes y el logo desde el <em>mismo dominio</em> o un CDN con cabeceras adecuadas.</p>
  </footer>

<script>
// ====== Datos (tus 10 imágenes) ======
const IMAGES = [
  { id:'img-01', title:'Imagen 01', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/8tollmf.png', alt:'CIRCPyCS imagen 01' },
  { id:'img-02', title:'Imagen 02', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/7r6LiSe.png', alt:'CIRCPyCS imagen 02' },
  { id:'img-03', title:'Imagen 03', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/tQmgrdh.png', alt:'CIRCPyCS imagen 03' },
  { id:'img-04', title:'Imagen 04', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/zOI3noF.png', alt:'CIRCPyCS imagen 04' },
  { id:'img-05', title:'Imagen 05', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/O8foZ29.png', alt:'CIRCPyCS imagen 05' },
  { id:'img-06', title:'Imagen 06', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/bIovVhP.png', alt:'CIRCPyCS imagen 06' },
  { id:'img-07', title:'Imagen 07', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/hHh0f8Y.png', alt:'CIRCPyCS imagen 07' },
  { id:'img-08', title:'Imagen 08', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/6AWeyPq.png', alt:'CIRCPyCS imagen 08' },
  { id:'img-09', title:'Imagen 09', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/yFoCxxb.png', alt:'CIRCPyCS imagen 09' },
  { id:'img-10', title:'Imagen 10', category:'Multimedia', date:'2025-08-22', tags:['CIRCPyCS'], src:'https://i.imgur.com/gCLtpg4.png', alt:'CIRCPyCS imagen 10' }
];

// ====== Config ======
const LOGO_URL = 'https://i.imgur.com/EpgiEcN.png';

// ====== Utilidades ======
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function formatDate(iso){
  const d = new Date(iso+'T00:00:00');
  return d.toLocaleDateString('es-BO', {year:'numeric', month:'short', day:'2-digit'});
}

function slug(s){
  const stripped = s.toLowerCase().normalize('NFD').split('').filter(ch => {
    const code = ch.charCodeAt(0);
    return !(code >= 0x300 && code <= 0x36f);
  }).join('');
  return stripped.replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
}

// ====== Render de galería ======
const gallery = $('#gallery');
let filtered = [...IMAGES];

function renderGallery(){
  gallery.innerHTML = '';
  const frag = document.createDocumentFragment();
  filtered.forEach((it, idx)=>{
    const card = document.createElement('article');
    card.className = 'card';

    const img = document.createElement('img');
    img.className = 'thumb';
    img.loading = 'lazy';
    img.alt = it.alt || it.title;
    img.src = it.src;
    img.addEventListener('click', ()=> openViewer(idx));

    const meta = document.createElement('div');
    meta.className = 'meta';

    const h3 = document.createElement('h3');
    h3.textContent = it.title;

    const tags = document.createElement('div');
    tags.className = 'tags';
    const t1 = document.createElement('span'); t1.className='tag'; t1.textContent = it.category; tags.appendChild(t1);
    const t2 = document.createElement('span'); t2.className='tag'; t2.textContent = formatDate(it.date); tags.appendChild(t2);

    meta.appendChild(h3); meta.appendChild(tags);

    card.appendChild(img);
    card.appendChild(meta);
    frag.appendChild(card);
  });
  gallery.appendChild(frag);
}

// ====== Filtros y orden ======
const q = $('#q');
const category = $('#category');
const sort = $('#sort');

function applyFilters(){
  const term = q.value.trim().toLowerCase();
  const cat = category.value;
  filtered = IMAGES.filter(it => {
    const okCat = !cat || it.category === cat;
    const haystack = `${it.title} ${(it.tags||[]).join(' ')}`.toLowerCase();
    const okTerm = !term || haystack.includes(term);
    return okCat && okTerm;
  });
  applySort();
}

function applySort(){
  const s = sort.value;
  filtered.sort((a,b)=>{
    if(s==='new') return b.date.localeCompare(a.date);
    if(s==='old') return a.date.localeCompare(b.date);
    if(s==='az') return a.title.localeCompare(b.title);
    if(s==='za') return b.title.localeCompare(a.title);
    return 0;
  });
  renderGallery();
}

q.addEventListener('input', applyFilters);
category.addEventListener('change', applyFilters);
sort.addEventListener('change', applySort);

// ====== Lightbox / Visor ======
const lightbox = $('#lightbox');
const viewImg = $('#viewImg');
const viewTitle = $('#viewTitle');
const viewCat = $('#viewCat');
const viewDate = $('#viewDate');
const downloadOriginal = $('#downloadOriginal');
const toggleFrame = $('#toggleFrame');
const frameOverlay = $('#frameOverlay');
const styleSel = $('#styleSel');
const overlayText = $('#overlayText');
const toggleLogo = $('#toggleLogo');
let currentIndex = 0;

// ====== Marcos ======
function overlaySVG(style, text, includeExternalLogo = true){
  const esc = (s)=> (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  const logoTag = includeExternalLogo ? `<image href="${LOGO_URL}" x="32" y="32" width="96" height="96" preserveAspectRatio="xMidYMid meet"/>` : '';

  if(style==='clasico'){
    return `
    <defs>
      <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="${getComputedStyle(document.documentElement).getPropertyValue('--brand-green').trim()}"/>
        <stop offset="1" stop-color="${getComputedStyle(document.documentElement).getPropertyValue('--brand-blue').trim()}"/>
      </linearGradient>
    </defs>
    <rect x="22" y="22" width="1036" height="1036" rx="34" fill="none" stroke="url(#g1)" stroke-width="20"/>
    <g fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--brand-red').trim()}" stroke-width="8" stroke-linecap="round">
      <path d="M80 240 V120 H240"/>
      <path d="M1000 240 V120 H840"/>
      <path d="M80 840 V960 H240"/>
      <path d="M1000 840 V960 H840"/>
    </g>
    <text x="1040" y="1046" text-anchor="end" fill="#e6eef7" font-size="28" font-weight="700" style="letter-spacing:.8px">CIRCPyCS</text>`;
  }
  if(style==='homenaje_bottom'){
    return `
    <rect x="0" y="920" width="1080" height="160" fill="${getComputedStyle(document.documentElement).getPropertyValue('--brand-blue').trim()}"/>
    <rect x="0" y="918" width="1080" height="3" fill="${getComputedStyle(document.documentElement).getPropertyValue('--brand-red').trim()}"/>
    ${logoTag}
    <text x="540" y="1000" text-anchor="middle" fill="#ffffff" font-size="44" font-weight="800">${esc(text)}</text>
    <text x="540" y="1050" text-anchor="middle" fill="#aab4d2" font-size="26" font-weight="600">CIRCPyCS · UAGRM</text>`;
  }
  if(style==='homenaje_top'){
    return `
    <polygon points="0,0 1080,0 1080,180 0,120" fill="${getComputedStyle(document.documentElement).getPropertyValue('--brand-red').trim()}"/>
    ${logoTag.replace('x="32"','x="952"')}
    <text x="60" y="110" fill="#ffffff" font-size="48" font-weight="900">${esc(text)}</text>
    <text x="60" y="150" fill="#ffe1e4" font-size="24" font-weight="700">CIRCPyCS · UAGRM</text>`;
  }
  if(style==='logo_corner'){
    return `
    <rect x="24" y="24" width="440" height="120" rx="18" fill="rgba(10,15,31,.75)" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--brand-green').trim()}"/>
    ${logoTag}
    <text x="140" y="86" fill="#e6eef7" font-size="34" font-weight="800">${esc(text)}</text>`;
  }
  if(style==='lateral_verde'){
    return `
    <rect x="0" y="0" width="140" height="1080" fill="${getComputedStyle(document.documentElement).getPropertyValue('--brand-green').trim()}"/>
    ${logoTag}
    <text transform="translate(30,1040) rotate(-90)" fill="#e6eef7" font-size="40" font-weight="900">${esc(text)}</text>
    <text transform="translate(90,1000) rotate(-90)" fill="#cfe9d8" font-size="22" font-weight="700">CIRCPyCS · UAGRM</text>`;
  }
  return '';
}

function updateOverlay(){
  if(!toggleFrame.checked){ frameOverlay.style.display='none'; return; }
  frameOverlay.style.display='block';
  const svgInner = overlaySVG(styleSel.value, overlayText.value, toggleLogo.checked);
  frameOverlay.innerHTML = svgInner; // contenido <g> por piezas
}

function openViewer(idx){
  currentIndex = idx;
  const it = filtered[currentIndex];
  viewImg.src = it.src;
  viewImg.alt = it.alt || it.title;
  viewTitle.textContent = it.title;
  viewCat.textContent = it.category;
  viewDate.textContent = formatDate(it.date);
  downloadOriginal.href = it.src;
  lightbox.classList.add('open');
  lightbox.setAttribute('aria-hidden','false');
  updateOverlay();
  // URL compartible
  const url = new URL(location.href); url.searchParams.set('id', it.id); history.replaceState(null,'',url);
}

function closeViewer(){
  lightbox.classList.remove('open');
  lightbox.setAttribute('aria-hidden','true');
  const url = new URL(location.href); url.searchParams.delete('id'); history.replaceState(null,'',url);
}

$('#close').addEventListener('click', closeViewer);
$('#prev').addEventListener('click', ()=> navigate(-1));
$('#next').addEventListener('click', ()=> navigate(1));

function navigate(step){
  if(!filtered.length) return;
  currentIndex = (currentIndex + step + filtered.length) % filtered.length;
  openViewer(currentIndex);
}

// Teclado
window.addEventListener('keydown', (e)=>{
  if(lightbox.classList.contains('open')){
    if(e.key==='Escape') closeViewer();
    if(e.key==='ArrowLeft') navigate(-1);
    if(e.key==='ArrowRight') navigate(1);
  }
});

// Clic fuera para cerrar
lightbox.addEventListener('click', (e)=>{ if(e.target===lightbox) closeViewer(); });

// Controles de marco
[toggleFrame, styleSel, overlayText, toggleLogo].forEach(el=> el.addEventListener('change', updateOverlay));
overlayText.addEventListener('input', updateOverlay);

// Copiar enlace
$('#copyLink').addEventListener('click', async ()=>{
  try{ await navigator.clipboard.writeText(location.href); alert('Enlace copiado'); }
  catch{ alert('No se pudo copiar el enlace'); }
});

// Pre-carga del logo para composiciones
let logoImg = null;
(function preloadLogo(){
  logoImg = new Image();
  logoImg.crossOrigin = 'anonymous';
  logoImg.src = LOGO_URL;
})();

// Descargar con marco (1080×1080)
$('#downloadFramed').addEventListener('click', async ()=>{
  const it = filtered[currentIndex];
  const img = new Image();
  img.crossOrigin = 'anonymous';
  img.src = it.src;
  await img.decode().catch(()=>{});

  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = 1080; canvas.height = 1080;
  ctx.clearRect(0,0,1080,1080);

  // cover
  const s = Math.max(1080/img.naturalWidth, 1080/img.naturalHeight);
  const w = img.naturalWidth*s, h = img.naturalHeight*s;
  const x = (1080 - w)/2, y = (1080 - h)/2;
  ctx.imageSmoothingQuality = 'high';
  ctx.drawImage(img, x, y, w, h);

  // Dibuja overlay (sin logo) como SVG raster
  const svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1080 1080">${overlaySVG(styleSel.value, overlayText.value, false)}</svg>`;
  const blob = new Blob([svg], {type:'image/svg+xml'});
  const url = URL.createObjectURL(blob);
  const overlayImg = new Image();
  await new Promise(res=>{ overlayImg.onload=()=>res(); overlayImg.src = url; });
  ctx.drawImage(overlayImg, 0, 0, 1080, 1080);
  URL.revokeObjectURL(url);

  // Dibuja logo si procede
  if(toggleLogo.checked && logoImg && logoImg.complete){
    const style = styleSel.value;
    if(style==='homenaje_bottom'){ ctx.drawImage(logoImg, 32, 932, 96, 96); }
    if(style==='homenaje_top'){ ctx.drawImage(logoImg, 952, 24, 96, 96); }
    if(style==='logo_corner'){ ctx.drawImage(logoImg, 32, 32, 96, 96); }
    if(style==='lateral_verde'){ ctx.drawImage(logoImg, 22, 24, 96, 96); }
  }

  // descarga
  const a = document.createElement('a');
  a.href = canvas.toDataURL('image/png');
  a.download = slug(it.title)+"_CIRCPyCS_1080.png";
  a.click();
});

// Soporte para abrir por ?id=
(function initFromURL(){
  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  if(id){ const idx = filtered.findIndex(it=> it.id===id); if(idx>=0){ openViewer(idx); } }
})();

// Inicializar
a pplyFilters();
</script>
</body>
</html>
