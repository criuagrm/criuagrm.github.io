<!doctype html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laboratorio de Análisis Político • CIRCPyCS</title>
  <meta name="description" content="LAP-CIRCPyCS: análisis electoral, indicadores institucionales y visualización interactiva para Bolivia 2025." />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter","ui-sans-serif","system-ui","Segoe UI","Roboto","Helvetica Neue","Arial"] }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <!-- Iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>

  <style>
    /* Menú móvil sencillo bajo el header */
    section[id]{ scroll-margin-top: 96px; }
    #btn-open #icon-x{ display:none; }
    #btn-open[aria-expanded="true"] #icon-bars{ display:none; }
    #btn-open[aria-expanded="true"] #icon-x{ display:block; }

    #mobile-menu{
      --header-h: 64px; /* fallback si JS no corre */
      max-height: calc(100vh - var(--header-h));
      max-height: calc(100svh - var(--header-h));
      max-height: calc(100dvh - var(--header-h));
      overflow-y: auto;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
  <!-- Cinta superior -->
  <div class="h-1 w-full bg-gradient-to-r from-emerald-600 via-sky-600 to-rose-600"></div>

  <!-- Header / Nav -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/70 border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
      <a href="#inicio" class="flex items-center gap-3">
        <img src="https://i.imgur.com/ldeXZmG.png" alt="Logo CIRCPyCS" class="h-9 w-9 sm:h-10 sm:w-10 object-contain" />
        <div class="leading-tight">
          <p class="text-sm tracking-wide text-slate-500">LAP — CIRCPyCS</p>
          <h1 class="font-bold text-lg">Laboratorio de Análisis Político</h1>
        </div>
      </a>

      <!-- Nav escritorio -->
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#dashboard" class="hover:text-sky-700">Indicadores</a>
        <a href="#visualizacion" class="hover:text-sky-700">Visualización</a>
        <a href="https://criuagrm.github.io/labapsoft.html" target="_blank" class="hover:text-sky-700">Software</a>
        <a href="https://criuagrm.github.io/labaproy.html" target="_blank" class="hover:text-sky-700">Proyectos</a>
        <a href="https://criuagrm.github.io/labapteam" target="_blank" class="hover:text-sky-700">Equipo</a>
        <a href="https://criuagrm.github.io/labapdata.html" target="_blank" class="hover:text-sky-700">Datasets</a>
        <a href="https://criuagrm.github.io/labapdashboard.html" target="_blank" class="hover:text-sky-700">Dashboard</a>
        <a href="https://cir.uagrm.edu.bo/" target="_blank" class="px-3 py-1.5 rounded-xl border border-sky-200 text-sky-700 hover:bg-sky-50">Volver al inicio</a>
      </nav>

      <!-- Botón móvil -->
      <button id="btn-open"
              class="md:hidden inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-slate-200"
              aria-expanded="false" aria-controls="mobile-menu" aria-label="Abrir menú">
        <span>Menú</span>
        <svg id="icon-bars" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
        <svg id="icon-x" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <!-- Menú móvil sencillo (dropdown bajo el header) -->
    <nav id="mobile-menu" class="md:hidden hidden border-t border-slate-200 bg-white shadow-[0_6px_22px_rgba(2,6,23,.06)]" aria-label="Navegación móvil">
      <ul class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 grid gap-1 text-[15px]">
        <li><a class="block px-3 py-2 rounded-lg hover:bg-slate-50" href="#dashboard">Indicadores</a></li>
        <li><a class="block px-3 py-2 rounded-lg hover:bg-slate-50" href="#visualizacion">Visualización</a></li>
        <li class="pt-2 mt-2 border-t border-slate-200 text-slate-500 text-xs px-3">Secciones externas</li>
        <li><a class="block px-3 py-2 rounded-lg hover:bg-slate-50" target="_blank" href="https://criuagrm.github.io/labapsoft.html">Software</a></li>
        <li><a class="block px-3 py-2 rounded-lg hover:bg-slate-50" target="_blank" href="https://criuagrm.github.io/labaproy.html">Proyectos</a></li>
        <li><a class="block px-3 py-2 rounded-lg hover:bg-slate-50" target="_blank" href="https://criuagrm.github.io/labapteam">Equipo</a></li>
        <li><a class="block px-3 py-2 rounded-lg hover:bg-slate-50" target="_blank" href="https://criuagrm.github.io/labapdata.html">Datasets</a></li>
        <li><a class="block px-3 py-2 rounded-lg hover:bg-slate-50" target="_blank" href="https://criuagrm.github.io/labapdashboard.html">Dashboard</a></li>
        <li><a class="block px-3 py-2 rounded-lg hover:bg-slate-50" target="_blank" href="https://cir.uagrm.edu.bo/">Volver al inicio</a></li>
      </ul>
    </nav>
  </header>

  <!-- Hero -->
  <section id="inicio" class="relative overflow-hidden">
    <div class="absolute inset-0 -z-10 opacity-20" aria-hidden="true">
      <div class="absolute -top-24 -left-24 h-64 w-64 rounded-full bg-emerald-500 blur-3xl"></div>
      <div class="absolute -bottom-24 -right-24 h-64 w-64 rounded-full bg-rose-500 blur-3xl"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-14 lg:py-20 text-center">
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200">Investigación avanzada · Visualización interactiva</span>
      <h2 class="mt-4 text-3xl sm:text-5xl font-extrabold tracking-tight">Laboratorio de Análisis Político</h2>
      <p class="mt-3 max-w-2xl mx-auto text-slate-600">Análisis electoral, indicadores institucionales y prospectiva para Bolivia 2025.</p>
      <div class="mt-6 flex justify-center">
        <a href="#visualizacion" class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold text-white bg-gradient-to-r from-emerald-600 via-sky-600 to-rose-600 shadow hover:shadow-lg hover:brightness-105">Elecciones nacionales 2025 <span>→</span></a>
      </div>
    </div>
  </section>

  <!-- Indicadores / KPIs -->
  <section id="dashboard" class="py-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h3 class="text-2xl font-bold text-center">Mega Dashboard Internacional Bolivia 2025</h3>
      <div class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5">
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-gavel mr-2"></i>Rule of Law (WJP 2024)</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">0.37</div>
          <div class="text-slate-600 text-sm">Puesto 131/142</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-globe mr-2"></i>Democracy Index (EIU 2023)</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">4.20/10</div>
          <div class="text-slate-600 text-sm">Régimen híbrido</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-university mr-2"></i>CPI Transparencia Intl.</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">28/100</div>
          <div class="text-slate-600 text-sm">Puesto 133/180</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-shield-alt mr-2"></i>Riesgo País (EMBI)</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">2,190 pb</div>
          <div class="text-slate-600 text-sm">2º más alto LatAm</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-chart-bar mr-2"></i>PIB per cápita (USD, 2023)</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">$3,680</div>
          <div class="text-slate-600 text-sm">Por debajo LatAm</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-users mr-2"></i>Población (2024)</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">12,318,000</div>
          <div class="text-slate-600 text-sm">Fuente: INE</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-thumbs-up mr-2"></i>Aprobación presidencial</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">24.1%</div>
          <div class="text-slate-600 text-sm">Mayo 2024</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-poll mr-2"></i>Confianza en elecciones</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">29%</div>
          <div class="text-slate-600 text-sm">Latinobarómetro 2023 (LatAm: 37%)</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-scale-balanced mr-2"></i>Confianza en justicia</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">15%</div>
          <div class="text-slate-600 text-sm">Latinobarómetro 2023 (LatAm: 21%)</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-user-friends mr-2"></i>Satisfacción democracia</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">19%</div>
          <div class="text-slate-600 text-sm">Latinobarómetro 2023</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-chart-area mr-2"></i>Pobreza monetaria</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">36.3%</div>
          <div class="text-slate-600 text-sm">INE 2023</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-graduation-cap mr-2"></i>Gasto educación (%PIB)</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">6.5%</div>
          <div class="text-slate-600 text-sm">Banco Mundial</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-heartbeat mr-2"></i>Esperanza de vida</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">70.8 años</div>
          <div class="text-slate-600 text-sm">OMS, 2024</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-briefcase mr-2"></i>Desempleo urbano</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">6.8%</div>
          <div class="text-slate-600 text-sm">INE 2024</div>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-5 shadow-sm hover:shadow-md transition">
          <div class="text-sky-700 text-sm font-semibold"><i class="fas fa-scale-balanced mr-2"></i>V-Dem democracia</div>
          <div class="mt-1 text-3xl font-extrabold text-slate-900">0.38</div>
          <div class="text-slate-600 text-sm">Escala 0–1 (2024)</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Visualización avanzada -->
  <section id="visualizacion" class="py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="rounded-3xl bg-slate-900 text-white p-6 sm:p-8 shadow-lg border border-slate-800">
        <h4 class="text-center text-xl font-semibold">Tracking Poll: Intención de voto presidencial 2025</h4>
        <p class="mt-1 text-center text-slate-300 text-sm">Serie con todas las mediciones públicas (mayo–agosto 2025). Toca la leyenda para activar/desactivar candidatos.</p>
        <div id="plotly-intencion-voto" class="mt-4" style="height:480px;width:100%;"></div>

        <div class="mt-6 grid gap-4 sm:grid-cols-2">
          <!-- Resultado oficial -->
          <div class="rounded-2xl bg-slate-800/60 p-4 border border-slate-700">
            <div class="flex items-center justify-between">
              <h5 class="font-semibold">Resultado oficial — Primera vuelta</h5>
              <span id="badge-res" class="text-xs px-2 py-1 rounded-full bg-slate-700 text-slate-300">oficial</span>
            </div>
            <p id="resumen-res" class="mt-1 text-slate-300 text-sm">Órgano Electoral Plurinacional</p>
            <div id="bars-resultado" class="mt-3" style="height:300px;width:100%;"></div>
          </div>

          <!-- Metadatos / Fuente -->
          <div class="rounded-2xl bg-slate-800/60 p-4 border border-slate-700">
            <h5 class="font-semibold">Cobertura y fuentes</h5>
            <ul class="mt-2 text-sm text-slate-300 space-y-1.5">
              <li>• <span class="font-medium">Ciemcorp</span> (Unitel): 22–26 mayo, 5–7 julio.</li>
              <li>• <span class="font-medium">SPIE</span> (El Deber): 7–14 junio, 5–10 julio, 25–28 julio, 31 jul–4 ago.</li>
              <li>• <span class="font-medium">Captura Consulting</span> (Red Uno): 10–20 junio, 27 jul–3 ago.</li>
              <li>• <span class="font-medium">Ipsos Ciesmori</span> (Unitel): 25–27 julio, 2–6 agosto.</li>
            </ul>
            <p class="mt-2 text-xs text-slate-400">Eje Y: % intención de voto. Eje X: fecha de cierre del trabajo de campo. Líneas y puntos grandes para lectura móvil.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="border-t border-slate-200 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-sm text-slate-600">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <p>© 2025 Centro de Investigación Regional en Ciencia Política y Ciencias Sociales UAGRM (CIRCPyCS). Todos los derechos reservados.</p>
        <p class="text-slate-500">Contacto: <a class="text-sky-700 hover:underline" href="mailto:cri.cspoliticas.fcjpsri@uagrm.edu.bo">cri.cspoliticas.fcjpsri@uagrm.edu.bo</a> · <i class="fas fa-phone"></i> +591 67381294</p>
      </div>
    </div>
  </footer>

  <script>
    // ===== Menú móvil simple =====
    const btnOpen = document.getElementById('btn-open');
    const mobileMenu = document.getElementById('mobile-menu');
    const headerEl = document.querySelector('header');
    function setHeaderVar(){ const h = headerEl.getBoundingClientRect().height || 64; mobileMenu.style.setProperty('--header-h', h + 'px'); }
    function toggleMenu(forceOpen = null){
      const willOpen = forceOpen !== null ? forceOpen : mobileMenu.classList.contains('hidden');
      if (willOpen) setHeaderVar();
      mobileMenu.classList.toggle('hidden', !willOpen);
      btnOpen.setAttribute('aria-expanded', String(willOpen));
      document.body.style.overflow = willOpen ? 'hidden' : '';
      if (willOpen) setTimeout(()=> mobileMenu.querySelector('a')?.focus(), 0); else btnOpen.focus();
    }
    btnOpen?.addEventListener('click', () => toggleMenu());
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') toggleMenu(false); });
    mobileMenu.addEventListener('click', (e) => { const link = e.target.closest('a'); if (link) toggleMenu(false); });
    window.addEventListener('resize', () => { if (!mobileMenu.classList.contains('hidden')) setHeaderVar(); });
    window.matchMedia('(min-width: 768px)').addEventListener('change', (ev) => { if (ev.matches) toggleMenu(false); });

    // ===== Datos de encuestas (ordenados por fecha de CIERRE) =====
    const x = [
      "26/05 Ciemcorp<br><span style='font-size:11px'>Unitel</span>",
      "14/06 SPIE<br><span style='font-size:11px'>El Deber</span>",
      "20/06 Captura<br><span style='font-size:11px'>Red Uno</span>",
      "07/07 Ciemcorp<br><span style='font-size:11px'>Unitel</span>",
      "10/07 SPIE<br><span style='font-size:11px'>El Deber</span>",
      "27/07 Ipsos<br><span style='font-size:11px'>Unitel</span>",
      "28/07 SPIE<br><span style='font-size:11px'>El Deber</span>",
      "03/08 Captura<br><span style='font-size:11px'>Red Uno</span>",
      "04/08 SPIE<br><span style='font-size:11px'>El Deber</span>",
      "06/08 Ipsos<br><span style='font-size:11px'>Unitel</span>"
    ];

    const colores = {
      "Samuel Doria Medina": "#F4B400",  // UNIDAD (dorado)
      "Jorge «Tuto» Quiroga": "#D32F2F", // LIBRE (rojo)
      "Manfred Reyes Villa":  "#6D28D9", // APB SÚMATE (morado)
      "Rodrigo Paz Pereira":  "#0E7C7B", // PDC (verde azulado)
      "Andrónico Rodríguez":  "#16A34A", // AP (verde)
      "Jhonny Fernández":    "#1E88E5"  // FP (azul)
    };

    const ySeries = {
      "Samuel Doria Medina": [19.1, 24.02, 19.6, 18.7, 21.76, 21.5, 24.5, 21.6, 23.64, 21.2],
      "Jorge «Tuto» Quiroga": [18.4, 22.07, 16.6, 18.1, 20.70, 19.6, 22.9, 20.0, 24.45, 20.0],
      "Manfred Reyes Villa":  [7.9,  9.39,  8.8,  8.2, 10.01,  8.3,  7.2,  9.7,  8.79,  7.7],
      "Rodrigo Paz Pereira":  [4.3,  5.56,  6.4,  3.2,  4.04,  5.8,  7.6,  6.4,  9.10,  8.3],
      "Andrónico Rodríguez":  [14.2, 14.69, 13.7, 11.8,  8.26,  6.1,  7.4,  7.2,  8.46,  5.5],
      "Jhonny Fernández":    [3.7,  2.56,  3.8,  2.5,  2.45,  1.8,  2.1,  2.0,  2.44,  2.0]
    };

    // ===== Resultado oficial (valores provistos) =====
    const resultadoOficial = {
      fecha: "Elección<br><span style='font-size:11px'>Primera vuelta</span>",
      fuente: "Órgano Electoral Plurinacional",
      valores: {
        "Rodrigo Paz Pereira": 32.06,
        "Jorge «Tuto» Quiroga": 26.70,
        "Samuel Doria Medina": 19.69,
        "Andrónico Rodríguez": 8.51,
        "Manfred Reyes Villa": 6.75,
        "Eduardo Del Castillo": 3.17,
        "Jhonny Fernández": 1.67,
        "Pavel Aracena Vargas": 1.45
      }
    };

    // ===== Construcción de la serie principal =====
    function buildTraces(includeOfficialPoint = true){
      const traces = [];
      for (const [nombre, ys] of Object.entries(ySeries)){
        const trace = {
          x: [...x],
          y: [...ys],
          name: nombre,
          mode: "lines+markers",
          line: { color: colores[nombre], width: 4 },
          marker: { size: 11 },
          hovertemplate: "<b>%{trace.name}</b><br>%{y:.2f}%<br>%{x}<extra></extra>"
        };
        if (includeOfficialPoint && resultadoOficial.valores[nombre] !== undefined){
          trace.x.push(resultadoOficial.fecha);
          trace.y.push(resultadoOficial.valores[nombre]);
        }
        traces.push(trace);
      }
      return traces;
    }

    function legendLayout(){
      if (window.innerWidth < 700){
        return { orientation:'v', x:1.02, y:0.5, xanchor:'left', yanchor:'middle', font:{size:11, color:'#fff'}, bgcolor:'rgba(15,23,42,0.96)' };
      } else {
        return { orientation:'h', x:0.01, y:1.18, font:{size:13, color:'#fff'} };
      }
    }
    function makeLayout(){
      const hasOficial = true;
      const maxY = Math.max(32.06, ...Object.values(ySeries).flat());
      return {
        plot_bgcolor: '#0b1220',
        paper_bgcolor: '#0b1220',
        legend: legendLayout(),
        xaxis: { title:{text:'<b>Fecha y encuestadora</b>', font:{color:'#fff', size:16}}, tickfont:{color:'#fff', size:12}, automargin:true, showgrid:false },
        yaxis: { title:{text:'<b>% intención de voto</b>', font:{color:'#fff', size:16}}, range:[0, Math.max(35, Math.ceil(maxY/5)*5)], gridcolor:'#334155', tickfont:{color:'#fff', size:12} },
        margin: { l:50, r: window.innerWidth < 700 ? 120 : 24, t:34, b:60 },
        shapes: [{
          type: "line", xref: "x", yref: "paper",
          x0: resultadoOficial.fecha, x1: resultadoOficial.fecha, y0: 0, y1: 1,
          line: { color: "#94a3b8", width: 2, dash: "dot" }
        }],
        annotations: [{
          x: resultadoOficial.fecha, y: 1.02, xref:"x", yref:"paper", xanchor:"center",
          text: "Resultado oficial", showarrow:false, font:{size:12, color:"#cbd5e1"}
        }],
        font: { family: 'Inter, Segoe UI, sans-serif', size:14, color:'#fff' }
      };
    }

    function renderLineChart(){
      Plotly.react('plotly-intencion-voto', buildTraces(true), makeLayout(), {responsive:true, displayModeBar:false});
    }

    // ===== Resultado oficial: barras (ordenadas de mayor a menor) =====
    function renderResultado(){
      const pares = Object.entries(resultadoOficial.valores).filter(([,v]) => v !== null && v !== undefined);
      pares.sort((a,b) => b[1] - a[1]);
      const nombres = pares.map(p => p[0]);
      const valores = pares.map(p => p[1]);

      // Mapeo candidato → alianza (según OEP)
      const alianzaPorCandidato = {
        "Rodrigo Paz Pereira": "PDC",
        "Jorge «Tuto» Quiroga": "LIBRE",
        "Samuel Doria Medina": "UNIDAD",
        "Andrónico Rodríguez": "AP",
        "Manfred Reyes Villa": "APB SÚMATE",
        "Eduardo Del Castillo": "MAS-IPSP",
        "Jhonny Fernández": "FP",
        "Pavel Aracena Vargas": "LYP-ADN"
      };

      // Colores por alianza (paleta aproximada a la usada en computo.oep.org.bo)
      const coloresAlianza = {
        "PDC": "#0E7C7B",
        "LIBRE": "#D32F2F",
        "UNIDAD": "#F4B400",
        "AP": "#16A34A",
        "APB SÚMATE": "#6D28D9",
        "MAS-IPSP": "#0D47A1",
        "FP": "#1E88E5",
        "LYP-ADN": "#111111"
      };
      const coloresBarras = nombres.map(n => coloresAlianza[alianzaPorCandidato[n]] || "#64748B");

      const barTrace = [{
        type: 'bar',
        x: valores,
        y: nombres,
        orientation: 'h',
        marker: { color: coloresBarras, line: { width: 0 } },
        hovertemplate: "<b>%{y}</b>: %{x:.2f}%<extra></extra>"
      }];

      const dynLeft = Math.min(260, Math.max(160, Math.max(...nombres.map(n => n.length))*7));

      const barLayout = {
        plot_bgcolor: '#0b1220',
        paper_bgcolor: '#0b1220',
        margin: { l: dynLeft, r: 20, t: 8, b: 40 },
        xaxis: { range: [0, Math.max(35, Math.ceil(Math.max(...valores) / 5) * 5)], gridcolor:'#334155', tickfont:{color:'#fff'} },
        yaxis: { tickfont:{color:'#fff'} },
        font: { family: 'Inter, Segoe UI, sans-serif', color:'#fff' }
      };

      Plotly.react('bars-resultado', barTrace, barLayout, {responsive:true, displayModeBar:false});
    }
      };

      Plotly.react('bars-resultado', barTrace, barLayout, {responsive:true, displayModeBar:false});
    }

    // ===== Render inicial + responsive =====
    renderLineChart();
    renderResultado();
    window.addEventListener('resize', () => { renderLineChart(); renderResultado(); });
  </script>
</body>
</html>

